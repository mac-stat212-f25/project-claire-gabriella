---
title: "msg"
format: html
---

```{r eval=FALSE}
# Code to clean and convert into matrix
library(readr)
library(stringr)
library(dplyr)
library(lubridate)
library(tidytext)
df <- readRDS("../msg_df.rds")

df <- df %>%
  mutate(
    date = ymd_hms(date),
    year  = year(date),
    month = month(date),
    day   = day(date),
    time  = format(date, "%H:%M:%S")
  )

df$id <- 1:nrow(df)

word_counts <- df %>%
  unnest_tokens(word, text) %>% 
  count(id, word, sort = TRUE)

word_counts %>%
  bind_tf_idf(term = word, document = id, n)
```

```{r}
df$id <- seq_len(nrow(df))   
tfidf <- df %>%
  unnest_tokens(word, text) %>%
  count(id, word) %>%
  bind_tf_idf(word, id, n)
df_joined <- df %>%
  left_join(tfidf %>% group_by(id) %>% summarise(tfidf = list(cur_data_all())),
            by = "id")
df_tidy <- df %>% left_join(tfidf, by = "id")
```

```{r}
library(Matrix)

tfidf_matrix <- tfidf %>%
  cast_sparse(id, word, tf_idf)
```

